var MemberSelectList = require('../../components/MemberSelectList');
var SelectList = require('../../components/SelectList');
var TaskHandle = require('../../handle/teamwork/Task');

module.exports = React.createClass({
	goto: function() {
		Utils.setUrl('/module4');
		var ModuleManage = require('../Manage');
		ModuleManage.getModule('module4', function(Virtual) {
			Event.trigger('SwitchModule', <Virtual/>);
		});
	},
	tabSwitch: function(ev) {
		switch ($(ev.currentTarget).attr('name')) {
			case 'task' :
				this.state.tabIndex = 1;
				break;
			case 'member' :
				this.state.tabIndex = 2;
				break;
			case 'count' :
				this.state.tabIndex = 3;
				break;
		}
		this.setState(this.state);
	},
	componentDidMount: function() {
		TaskHandle.getOneProjectTask('a9ceeb056a958632f5d63dae', function(result) {
			if(result.code == 200) {
				console.log(JSON.stringify(result))
				this.state.taskList =result.data.entrys;
				this.state.taskList.forEach(function(item) {
					console.log(item._id)
					TaskHandle.getOne(item._id, function(result) {
						console.log(JSON.stringify(result));
						this.state.taskDetailList[item._id] = result;
					}.bind(this));
				}.bind(this));
			}
		}.bind(this));
	},
	getInitialState: function() {
		return {taskList: [], taskDetailList: {}, tabIndex: 1};
	},
	render: function() {
		var resultTaskList = [];
		var taskListTemp = {};
		for (var i in this.state.taskList) {
			if(taskListTemp[i]) taskListTemp[i] = [];
			taskListTemp[i].push(
				<li key={i} onClick={this.goto}>
					<label className="check"><input type="checkbox"/><i></i></label>
					<div className="text">
						<div className="top_block">
							<span className="text">针对每一次通话加入后处理时间</span>
							<span className="tip later">韩梅梅10月15日</span>
						</div>
					</div>
				</li>
			)
		}
		for(var j in taskListTemp) {
			if(taskListTemp[j].length > 0) {
				resultTaskList.push(
					<SelectList key={j} tittle={j}>{taskListTemp[j]}</SelectList>
				)
			}
		}
		return <div className="default_project_page">
				<div className="tab_box">
					<ul>
						<li onClick={this.tabSwitch} name="task" className={this.state.tabIndex == 1 ? 'bkg' : ''}><label>任务</label></li>
						<li onClick={this.tabSwitch} name="member" className={this.state.tabIndex == 2 ? 'bkg' : ''}><label>成员</label></li>
						<li onClick={this.tabSwitch} name="count" className={this.state.tabIndex == 3 ? 'bkg' : ''}><label>统计</label></li>
					</ul>
				</div>
				<div>
					{this.state.tabIndex != 1 ? null : resultTaskList}
				</div>
				<div>
					{this.state.tabIndex != 2 ? null : <MemberSelectList ref="memberSelectList" />}
				</div>
		</div>
	}
});

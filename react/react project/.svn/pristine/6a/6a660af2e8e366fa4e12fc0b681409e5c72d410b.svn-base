module.exports = React.createClass({
    touchStartEvent: function(e) {
		if (e.changedTouches.length != 1) return false;
		$(e.currentTarget).css('transition', null);
        var finger = e.changedTouches[0];
		this.state.point = {x: finger.screenX};
    },
    touchMoveEvent: function(e) {
		if (!this.state.point) return false;
		Config.locked = true;

		var finger = e.changedTouches[0];
		var touch = this.state;

		var diffX = this.state.point.x - finger.screenX;
		var dom = $(e.currentTarget);

		if (!this.state.open && diffX >= 0) {
			if (diffX > 100) diffX = 100;
			dom.css('left', -diffX);
			return true;
		}
    },
    touchEndEvent: function(e) {
		if (!this.state.point) return false;
		var finger = e.changedTouches[0];

		if (this.state.point.x - finger.screenX > (this.state.scrollWidth / 3)) {
			this.state.point = null;
			return this.out();
		}

		this.state.point = null;
		return this.back();
    },
    back: function() {
		if (!this.state.open) return true;
        $(this.refs.moveLi).css({transition: 'left .2s', left: 0});
        Config.locked = this.state.open = false;
    },
    out: function() {
        $(this.refs.moveLi).css({transition: 'left .2s', 'left': -this.state.scrollWidth});
		Config.locked = this.state.open = true;
    },
    componentDidMount:function() {
		Event.on('ReleaseLock', this.back);
    },
    componentWillUnmount:function() {
        Event.off('ReleaseLock', this.back);
    },
    getInitialState: function() {
        return {point: null, open: false, scrollWidth: 140 * (parseInt($('html').css('font-size')) / 20)};
    },
    render: function() {
        return <li ref="moveLi" onTouchStart={this.touchStartEvent} onTouchMove={this.touchMoveEvent} onTouchEnd={this.touchEndEvent}>
					{this.props.children}
				</li>;
    }
});
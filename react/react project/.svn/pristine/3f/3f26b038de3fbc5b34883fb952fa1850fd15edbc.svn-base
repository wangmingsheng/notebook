/**
 * Created by Administrator on 2016/9/19.
 */
var SwipeLi = React.createClass({
    touchObject: {startPosition: {}, endPosition: {}, deltaX: 0, length: 140 * (parseInt($('html').css('font-size')) / 20), startState: 0},
    touchStartEvent: function(e) {
        $(e.currentTarget).css('transition', 'left 0s');
        var touch = e.changedTouches[0];
        var dom = e.currentTarget;
        if(!parseInt($(dom).css('left'))) {
            $(dom).css('left', 0);
        } else {
            this.touchObject.startState = 1;
        }
        this.touchObject.startPosition = {
            x: touch.pageX,
            y: touch.pageY
        }
    },
    touchMoveEvent: function(e) {
        var touch = e.changedTouches[0];
        var dom = e.currentTarget;
        var length  = this.touchObject.length;
        var startPosition = this.touchObject.startPosition;
        var endPosition = this.touchObject.endPosition = {
            x: touch.pageX,
            y: touch.pageY
        };

        var deltaX =this.touchObject.deltaX = endPosition.x - startPosition.x;
        if(parseInt($(dom).css('left')) >= -length && parseInt($(dom).css('left')) <= 0) {
            if(this.touchObject.startState == 0 && deltaX < 0 && deltaX > -length) $(dom).css('left', deltaX + 'px');
            if(this.touchObject.startState == 1 && deltaX > 0 && deltaX < length) $(dom).css('left', deltaX - length + 'px');
        }
    },
    touchEndEvent: function(e) {
        var dom = e.currentTarget;
        var deltaX =this.touchObject.deltaX;
        var length  = this.touchObject.length;

        $(e.currentTarget).css('transition', 'left .3s');
        if(deltaX < 0 && parseInt($(dom).css('left')) > -length ) { // 向左划动
            if(Math.abs(deltaX) > 0.3*length) $(dom).css('left', -length + 'px');
            if(Math.abs(deltaX) <= 0.3*length) $(dom).css('left', 0+ 'px');
        } else if (deltaX > 0 && parseInt($(dom).css('left')) < 0) { // 向右划动
            if(Math.abs(deltaX) > 0.3*length) $(dom).css('left', 0 + 'px');
            if(Math.abs(deltaX) <= 0.3*length) $(dom).css('left', -length + 'px');
        }
        if(parseInt($(dom).css('left')) == 0) {
            this.touchObject.startState = 0;
        } else {
            this.touchObject.startState = 1;
        }
    },
    getInitialState: function() {
        return {};
    },
    render: function() {

        return <li onTouchStart={this.touchStartEvent} onTouchMove={this.touchMoveEvent} onTouchEnd={this.touchEndEvent}>
            {this.props.children}
            </li>
    }
});

module.exports = SwipeLi;
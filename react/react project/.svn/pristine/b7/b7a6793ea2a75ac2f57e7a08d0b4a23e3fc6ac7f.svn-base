var SwitchBox = require('../../components/SwitchBox');
var PushUpDialog = require('../../components/PushUpDialog');
var AcrossMbShow = require('../../components/AcrossMbShow');
var Member = require('../../components/Member');
var TaskHandle = require('../../handle/teamwork/Task');
var ProjectData = require('../../data/Project');

module.exports = React.createClass({
	completed: function() {
		var param ={
			name: this.state.value,
		};
		if(!param.name.trim()) {
			Interface.alert('任务节点不能为空');
			return false;
		}
		this.setHeader('提交中');
		TaskHandle.createEntrys(ProjectData.currentId, param, function(result) {
			if(result.code == 200) {
				ProjectData.source[ProjectData.currentId].entrys.push(param);
				return history.back();
			}
			this.setHeader();
		}.bind(this));
	},
	taskTittle: function(ev) {
		this.state.value = $(ev.currentTarget).val();
	},
	switchEvent: function() {
		this.state.value.visibility = !this.state.value.visibility;
		this.setState(this.state);
	},
	setHeader: function(text) {
		var headObject = {title: '新建任务清单', back: {text: '后退'}, operat: {text: '完成', event: this.completed}};
		if(text) {
			headObject.operat.text = text;
			headObject.back.event = headObject.operat.event = function() {};
		}
		Interface.setHeader(headObject);
	},
	dataRequest: function() {
		Interface.webEndRefresh();
	},
	componentDidMount: function() {
		Event.on('webBeginRefresh', this.dataRequest);
	},
	componentWillUnmount: function() {
		Event.off('webBeginRefresh', this.dataRequest);
	},
	getInitialState: function() {
		this.setHeader();
		return {value: ''};
	},
	render: function() {
		return <div className="newtask_page">
					<ul>
						<li><input type="text" placeholder="任务节点名称" onChange={this.taskTittle} /></li>
					</ul>
			</div>
	}
});

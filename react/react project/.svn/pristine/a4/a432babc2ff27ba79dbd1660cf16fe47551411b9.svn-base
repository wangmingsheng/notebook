var SwitchBox = require('../../components/SwitchBox');
var PushUpDialog = require('../../components/PushUpDialog');
var Module2 = require('./Module2');
module.exports = React.createClass({
	goto: function() {
		Utils.setUrl('/module2');
		var ModuleManage = require('../Manage');
		ModuleManage.getModule('module2', function(Virtual) {
			Event.trigger('SwitchModule', <Virtual/>);
		});
	},
	completed: function() {
		var param = this.state.value;
		TaskHandle.create(this.state.value.projectId, param, function(result) {
			if(result.code == 200) {
				history.back();
			}
		});
	},
	selectMembers: function() {
		this.refs.pushUpDialog.out();
	},
	addMembers: function(result) {
		this.refs.pushUpDialog.in();
/*		var persons = [];
		for(var i in result){
			if(result[i]) persons.push(i);
		}
		this.value.assign = persons.join(' ');*/
	},
	taskTittle: function(ev) {
		this.value.title = $(ev.currentTarget).val();
	},
	switchEvent: function() {
		this.state.value.visibility = !this.state.value.visibility;
		this.setState(this.state);
	},
	getInitialState: function() {
		var list = [{text: '确定', event: this.completed}];
		var headObject = {title: '新建任务', back: '后退', operat: {text: '完成', list: list}};
		Interface.setHeader(headObject);
		var value = { projectId:'', assign: "", deadline: 0, entry: "", title: "", visibility: true};
		return {value:value};
	},
	render: function() {
		return <div className="newtask_page wrap">
					<ul>
						<li><input type="text" placeholder="任务名称" onChange={this.taskTittle} /></li>
					</ul>
					<ul className="jump_option_list">
						<li onClick={this.selectMembers}><span className="option">分配给</span><span className="right_block"><span className="tip"></span><i className="icon">&#xe606;</i></span></li>
						<li><span className="option">截止时间</span><span className="right_block"><span className="tip"></span><i className="icon">&#xe606;</i></span></li>
					</ul>
	
					<ul className="jump_option_list">
						<li><span className="option">项目</span><span className="right_block"><span className="tip">默认项目</span><i className="icon">&#xe606;</i></span></li>
						<li><span className="option">任务列表</span><span className="right_block"><span className="tip">需求分析</span><i className="icon">&#xe606;</i></span></li>
					</ul>
	
					<ul className="jump_option_list">
						<li><span className="option">私密任务</span><span className="right_block"><SwitchBox checked={this.state.value.visibility} onChange={this.switchEvent}/></span></li>
					</ul>
					<PushUpDialog ref="pushUpDialog"><Module2 addMembers={this.addMembers}/></PushUpDialog>
			</div>
	}
});

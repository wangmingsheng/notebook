var TaskHandle = require('../../handle/teamwork/Task');
var ProjectData = require('../../data/Project');

module.exports = React.createClass({
	completed: function() {
		var param ={
			name: $(this.refs.entryTitle).val(),
		};
		if(!param.name.trim()) {
			Interface.alert('任务节点不能为空');
			return false;
		}
		Utils.closeKeyBord(this.refs.entryTitle);
		this.setHeader('提交中');
		TaskHandle.createEntrys(this.props.param[0], param, function(result) {
			if(result.code == 200) {
				ProjectData.source[this.props.param[0]].entrys.push(result.data);
				return history.back();
			}
			this.setHeader();
		}.bind(this));
	},
	setHeader: function(text) {
		var headObject = {
			title: '新建任务清单', back: {text: '后退', event: function() {
				Utils.closeKeyBord(this.refs.entryTitle);
			}.bind(this)},
			operat: {text: '完成', event: this.completed}
		};
		if(text) {
			headObject.operat.text = text;
			headObject.back.event = headObject.operat.event = function() {};
		}
		Interface.setHeader(headObject);
	},
	dataRequest: function() {
		Interface.webEndRefresh();
	},
	componentDidMount: function() {
		Event.on('webBeginRefresh', this.dataRequest);
	},
	componentWillUnmount: function() {
		Event.off('webBeginRefresh', this.dataRequest);
	},
	getInitialState: function() {
		this.setHeader();
		return {};
	},
	render: function() {
		return <div className="newtask_page">
					<ul>
						<li><input ref='entryTitle' type="text" placeholder="任务节点名称" /></li>
					</ul>
			</div>
	}
});
